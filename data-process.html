<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Processor &mdash; yamlprocessor 0.4 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Schema Processor" href="schema-process.html" />
    <link rel="prev" title="Basic Usages" href="basic-usage.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> yamlprocessor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-usage.html">Basic Usages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Processor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#modularisation-include">Modularisation / Include</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modularisation-include-with-query">Modularisation / Include with Query</a></li>
<li class="toctree-l2"><a class="reference internal" href="#string-value-variable-substitution">String Value Variable Substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#string-value-date-time-substitution">String Value Date-Time Substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#turn-off-processing">Turn Off Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validation-with-json-schema">Validation with JSON Schema</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="schema-process.html">Schema Processor</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">yamlprocessor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Data Processor</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//MetOffice/yamlprocessor/blob/data-process.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="data-processor">
<h1>Data Processor<a class="headerlink" href="#data-processor" title="Permalink to this headline">¶</a></h1>
<div class="section" id="modularisation-include">
<h2>Modularisation / Include<a class="headerlink" href="#modularisation-include" title="Permalink to this headline">¶</a></h2>
<p>Consider an input YAML file containing the following data:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hello</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">INCLUDE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth.yaml</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">INCLUDE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mars.yaml</span><span class="w"></span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">earth.yaml</span></code> contains:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth</span><span class="w"></span>
<span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">human</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog</span><span class="w"></span>
</pre></div>
</div>
<p>And <code class="docutils literal notranslate"><span class="pre">mars.yaml</span></code> contains:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mars</span><span class="w"></span>
<span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">martian</span><span class="w"></span>
</pre></div>
</div>
<p>Running the processor on the input YAML file will yield the following output:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hello</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth</span><span class="w"></span>
<span class="w">    </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">human</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mars</span><span class="w"></span>
<span class="w">    </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">martian</span><span class="w"></span>
</pre></div>
</div>
<p>If an include file is specified as a relative location, the processor searches
for it from these locations in order:</p>
<blockquote>
<div><ul class="simple">
<li><p>The folder/directory containing the parent file.</p></li>
<li><p>The current working folder/directory.</p></li>
<li><p>The list of include folders/directories. This list can be specified:</p>
<ul>
<li><p>Using the environment variable <code class="docutils literal notranslate"><span class="pre">YP_INCLUDE_PATH</span></code>. Use the same syntax as
the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> environment variable on your platform to specify multiple
folders/directories.</p></li>
<li><p>Using the command line option <a class="reference internal" href="cli.html#cmdoption-yp-data-include"><code class="xref std std-option docutils literal notranslate"><span class="pre">--include=DIR</span></code></a>.
This option can be used multiple times.
The utility will append each <code class="docutils literal notranslate"><span class="pre">DIR</span></code> to the list.</p></li>
<li><p>In the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..include_paths" title="yamlprocessor.dataprocess.DataProcessor..include_paths"><code class="xref py py-attr docutils literal notranslate"><span class="pre">include_paths</span></code></a> (list) attribute of the relevant
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>LIMITATION. It is worth noting that YAML anchors/references will only work
within files, so an include file will not see anchors in the parent file,
and vice versa.</p>
</div>
<div class="section" id="modularisation-include-with-query">
<h2>Modularisation / Include with Query<a class="headerlink" href="#modularisation-include-with-query" title="Permalink to this headline">¶</a></h2>
<p>Consider an example where we want to include only a subset of the data structure
from the include file. We can use a <a class="reference external" href="https://jmespath.org/">JMESPath</a>
query to achieve this.</p>
<p>For example, we may have something like this in <code class="docutils literal notranslate"><span class="pre">hello-root.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hello</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">INCLUDE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">planets.yaml</span><span class="w"></span>
<span class="w">  </span><span class="nt">QUERY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[?type==&#39;rocky&#39;]&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">planets.yaml</span></code> contains:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rocky</span><span class="w"></span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">human</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mars</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rocky</span><span class="w"></span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">martian</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">jupiter</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gaseous</span><span class="w"></span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
</pre></div>
</div>
<p>The processor will select the planets of rocky type,
and the output will look like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">hello</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rocky</span><span class="w"></span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">human</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cat</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dog</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mars</span><span class="w"></span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rocky</span><span class="w"></span>
<span class="w">  </span><span class="nt">targets</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">martian</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="string-value-variable-substitution">
<h2>String Value Variable Substitution<a class="headerlink" href="#string-value-variable-substitution" title="Permalink to this headline">¶</a></h2>
<p>Consider:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${SWEET_HOME}/sugar.txt</span><span class="w"></span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">SWEET_HOME</span></code> is defined in the environment and has a value <code class="docutils literal notranslate"><span class="pre">/home/sweet</span></code>,
then passing the above input to the processor will give the following output:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/sweet/sugar.txt</span><span class="w"></span>
</pre></div>
</div>
<p>Note:</p>
<blockquote>
<div><ul class="simple">
<li><p>The processor recognises both <code class="docutils literal notranslate"><span class="pre">$SWEET_HOME</span></code> or <code class="docutils literal notranslate"><span class="pre">${SWEET_HOME}</span></code>.</p></li>
<li><p>The processor is not implemented using a shell,
so shell variable syntax won’t work.</p></li>
</ul>
</div></blockquote>
<p>You can configure what variables are available for substitution.</p>
<p>On the command line:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use the <a class="reference internal" href="cli.html#cmdoption-yp-data-define"><code class="xref std std-option docutils literal notranslate"><span class="pre">--define=KEY=VALUE</span></code></a>
(<code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">KEY=VALUE</span></code>) option
to define new variables or override the value of an existing one.</p></li>
<li><p>Use the <a class="reference internal" href="cli.html#cmdoption-yp-data-undefine"><code class="xref std std-option docutils literal notranslate"><span class="pre">--undefine=KEY</span></code></a> (<code class="docutils literal notranslate"><span class="pre">-U</span> <span class="pre">KEY</span></code>)
option to remove a variable.</p></li>
<li><p>Use the <a class="reference internal" href="cli.html#cmdoption-yp-data-no-environment"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-environment</span></code></a> (<code class="docutils literal notranslate"><span class="pre">-i</span></code>) option
if you do not want to use any variables defined in the environment for
substitution. (So only those specified with
<a class="reference internal" href="cli.html#cmdoption-yp-data-define"><code class="xref std std-option docutils literal notranslate"><span class="pre">--define=KEY=VALUE</span></code></a> will work.)</p></li>
</ul>
</div></blockquote>
<p>In Python, simply manipulate the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..variable_map" title="yamlprocessor.dataprocess.DataProcessor..variable_map"><code class="xref py py-attr docutils literal notranslate"><span class="pre">variable_map</span></code></a> (dict) attribute of
the relevant <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance. The
dict is a copy of <code class="xref py py-data docutils literal notranslate"><span class="pre">os.environ</span></code> at initialisation.</p>
<p>Finally, if you reference a variable in YAML that is not defined, you will
normally get an unbound variable error. You can modify this behaviour by setting
a place holder. On the command line, use the
<a class="reference internal" href="cli.html#cmdoption-yp-data-unbound-placeholder"><code class="xref std std-option docutils literal notranslate"><span class="pre">--unbound-placeholder=VALUE</span></code></a>
option. In Python, set the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..unbound_placeholder" title="yamlprocessor.dataprocess.DataProcessor..unbound_placeholder"><code class="xref py py-attr docutils literal notranslate"><span class="pre">unbound_placeholder</span></code></a> attribute of the
relevant <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance to a
string value.</p>
</div>
<div class="section" id="string-value-date-time-substitution">
<h2>String Value Date-Time Substitution<a class="headerlink" href="#string-value-date-time-substitution" title="Permalink to this headline">¶</a></h2>
<p>The YAML processor utility also supports date-time substitution using a
similar syntax, for variables names starting with:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">YP_TIME_NOW</span></code> (current time, time when <strong class="program">yp-data</strong> starts running
or set on initialisation of a
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">YP_TIME_REF</span></code> (reference time, specified using the <span class="target" id="index-0"></span><a class="reference internal" href="cli.html#envvar-YP_TIME_REF_VALUE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">YP_TIME_REF_VALUE</span></code></a>
environment variable, the <a class="reference internal" href="cli.html#cmdoption-yp-data-time-ref"><code class="xref std std-option docutils literal notranslate"><span class="pre">--time-ref=VALUE</span></code></a>
command line option, or the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..time_ref" title="yamlprocessor.dataprocess.DataProcessor..time_ref"><code class="xref py py-attr docutils literal notranslate"><span class="pre">time_ref</span></code></a> attribute of the relevant
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance in Python). If
no value is set for the reference time, any reference to the reference time
will simply use the current time.</p></li>
</ul>
</div></blockquote>
<p>You can use one or more of these trailing suffixes to apply deltas for the
date-time:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_PLUS_XXX</span></code>: adds the duration to the date-time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_MINUS_XXX</span></code>: substracts the duration to the date-time.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_AT_xxx</span></code>: sets individual fields of the date-time.
E.g., <code class="docutils literal notranslate"><span class="pre">_AT_T0H</span></code> will set the hour of the day part of the date-time to
<code class="docutils literal notranslate"><span class="pre">00</span></code> hour.</p></li>
</ul>
</div></blockquote>
<p>where <code class="docutils literal notranslate"><span class="pre">xxx</span></code> is date-time duration-like syntax in the form <code class="docutils literal notranslate"><span class="pre">nYnMnDTnHnMnS</span></code>,
e.g.:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">12Y</span></code> is 12 years.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1M2D</span></code> is 1 month and 2 days.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1DT12H</span></code> is 1 day and 12 hours.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">T12H30M</span></code> is 12 hours and 30 minutes.</p></li>
</ul>
</div></blockquote>
<p>Examples, (for argument sake, let’s assume the
current time is <code class="docutils literal notranslate"><span class="pre">2022-02-01T10:11:18Z</span></code> and
we have set the reference time to <code class="docutils literal notranslate"><span class="pre">2024-12-25T11:11:11Z</span></code>.)</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>${YP_TIME_NOW}</p></td>
<td><p>2022-02-01T10:11:18Z</p></td>
</tr>
<tr class="row-odd"><td><p>${YP_TIME_NOW_AT_T0H0M0S}</p></td>
<td><p>2022-02-01T00:00:00Z</p></td>
</tr>
<tr class="row-even"><td><p>${YP_TIME_NOW_AT_T0H0M0S_PLUS_T12H}</p></td>
<td><p>2022-02-01T12:00:00Z</p></td>
</tr>
<tr class="row-odd"><td><p>${YP_TIME_REF}</p></td>
<td><p>2024-12-25T11:11:11Z</p></td>
</tr>
<tr class="row-even"><td><p>${YP_TIME_REF_AT_1DT18H}</p></td>
<td><p>2024-12-01T18:11:11Z</p></td>
</tr>
<tr class="row-odd"><td><p>${YP_TIME_REF_PLUS_T6H30M}</p></td>
<td><p>2024-12-25T17:41:11Z</p></td>
</tr>
<tr class="row-even"><td><p>${YP_TIME_REF_MINUS_1D}</p></td>
<td><p>2024-12-24T11:11:11Z</p></td>
</tr>
</tbody>
</table>
<p>You can specify different date-time output formats using:</p>
<blockquote>
<div><ul class="simple">
<li><p>Environment variables <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">YP_TIME_FORMAT[_&lt;NAME&gt;]</span></code>.</p></li>
<li><p>The command line option
<a class="reference internal" href="cli.html#cmdoption-yp-data-time-format"><code class="xref std std-option docutils literal notranslate"><span class="pre">--time-format=[NAME=]FORMAT</span></code></a>.</p></li>
<li><p>The <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..time_formats" title="yamlprocessor.dataprocess.DataProcessor..time_formats"><code class="xref py py-attr docutils literal notranslate"><span class="pre">time_formats</span></code></a> (dict) attribute of the relevant
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a>
instance in Python. The default format is <code class="docutils literal notranslate"><span class="pre">%FT%T%:z</span></code>.</p></li>
</ul>
</div></blockquote>
<p>For example, if you set:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--time-format='%FT%T%:z'</span></code> (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--time-format=CTIME='%a</span> <span class="pre">%e</span> <span class="pre">%b</span> <span class="pre">%T</span> <span class="pre">%Z</span> <span class="pre">%Y'</span></code>
or <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">YP_TIME_FORMAT_CTIME='%a</span> <span class="pre">%e</span> <span class="pre">%b</span> <span class="pre">%T</span> <span class="pre">%Z</span> <span class="pre">%Y'</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--time-format=ABBR='%Y%m%dT%H%M%S%z'</span></code>
or <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">YP_TIME_FORMAT_ABBR='%Y%m%dT%H%M%S%z'</span></code></p></li>
</ul>
</div></blockquote>
<p>Then:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>${YP_TIME_REF}</p></td>
<td><p>2024-12-25T11:11:11Z</p></td>
</tr>
<tr class="row-odd"><td><p>${YP_TIME_REF_FORMAT_CTIME}</p></td>
<td><p>Wed 25 Dec 11:11:11 GMT 2024</p></td>
</tr>
<tr class="row-even"><td><p>${YP_TIME_REF_PLUS_T12H_FORMAT_ABBR}</p></td>
<td><p>20241225T231111Z</p></td>
</tr>
</tbody>
</table>
<p>See <a class="reference external" href="https://man7.org/linux/man-pages/man3/strftime.3.html">strftime</a>,
for example, for a list of date-time format code. The processor also
supports the following format codes for numeric time zone:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">%:z</span></code> +hh:mm numeric time zone (e.g., -08:00, +05:45).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%::z</span></code> + hh:mm numeric time zone (e.g., -08:00:00, +05:45:00).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">%:::z</span></code> numeric time zone with <code class="docutils literal notranslate"><span class="pre">:</span></code> to the necessary precision
(e.g., -08, +05:45).</p></li>
</ul>
<p>In addition, for all numeric time zone format code (including <code class="docutils literal notranslate"><span class="pre">%z</span></code>),
the processor will use <code class="docutils literal notranslate"><span class="pre">Z</span></code> to denote UTC time zone (instead of for
example <code class="docutils literal notranslate"><span class="pre">+00:00</span></code>) to save space.</p>
<p>Finally, if a variable name is already in the variable substitution mapping,
e.g., defined in the environment or in a <code class="docutils literal notranslate"><span class="pre">--define=...</span></code> option, then the
defined value takes precedence, so if you have already <code class="docutils literal notranslate"><span class="pre">export</span>
<span class="pre">YP_TIME_REF=whatever</span></code>, then you will get the value <code class="docutils literal notranslate"><span class="pre">whatever</span></code> instead of the
reference time.</p>
</div>
<div class="section" id="turn-off-processing">
<h2>Turn Off Processing<a class="headerlink" href="#turn-off-processing" title="Permalink to this headline">¶</a></h2>
<p>If you need to turn off processing of <code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code> syntax, you can do:</p>
<blockquote>
<div><ul class="simple">
<li><p>On the command line, use the
<a class="reference internal" href="cli.html#cmdoption-yp-data-no-process-include"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-process-include</span></code></a> option.</p></li>
<li><p>In Python, set the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..is_process_include" title="yamlprocessor.dataprocess.DataProcessor..is_process_include"><code class="xref py py-attr docutils literal notranslate"><span class="pre">is_process_include</span></code></a> attribute of the relevant
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
</div></blockquote>
<p>If you need to turn off processing of variable and date-time substitution,
you can do:</p>
<blockquote>
<div><ul class="simple">
<li><p>On the command line, use the
<a class="reference internal" href="cli.html#cmdoption-yp-data-no-process-variable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-process-variable</span></code></a> option.</p></li>
<li><p>In Python, set the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..is_process_variable" title="yamlprocessor.dataprocess.DataProcessor..is_process_variable"><code class="xref py py-attr docutils literal notranslate"><span class="pre">is_process_variable</span></code></a> attribute of the relevant
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="validation-with-json-schema">
<h2>Validation with JSON Schema<a class="headerlink" href="#validation-with-json-schema" title="Permalink to this headline">¶</a></h2>
<p>You can tell the processor to look for a JSON schema file and validate
the current YAML file by adding a <code class="docutils literal notranslate"><span class="pre">#!&lt;SCHEMA-URI&gt;</span></code> to the beginning
of the YAML file. The <code class="docutils literal notranslate"><span class="pre">SCHEMA-URI</span></code> is a string pointing to the location
of a JSON schema file. Some simple assumptions apply:</p>
<blockquote>
<div><ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">SCHEMA-URI</span></code> is a normal URI with a leading scheme,
e.g., <code class="docutils literal notranslate"><span class="pre">https://</span></code>, it is used as-is.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">SCHEMA-URI</span></code> does not have a leading scheme and exists in the local
file system, then it is also used as-is.</p></li>
<li><p>Otherwise, a schema URI prefix can be specified to add to the value of
<code class="docutils literal notranslate"><span class="pre">SCHEMA-URI</span></code> using:</p>
<ul>
<li><p>The <span class="target" id="index-2"></span><a class="reference internal" href="cli.html#envvar-YP_SCHEMA_PREFIX"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">YP_SCHEMA_PREFIX</span></code></a> environment variable.</p></li>
<li><p>On the command line, the
<a class="reference internal" href="cli.html#cmdoption-yp-data-schema-prefix"><code class="xref std std-option docutils literal notranslate"><span class="pre">--schema-prefix=PREFIX</span></code></a> option.</p></li>
<li><p>In Python, the <a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor..schema_prefix" title="yamlprocessor.dataprocess.DataProcessor..schema_prefix"><code class="xref py py-attr docutils literal notranslate"><span class="pre">schema_prefix</span></code></a> attribute of the relevant
<a class="reference internal" href="api.html#yamlprocessor.dataprocess.DataProcessor" title="yamlprocessor.dataprocess.DataProcessor"><code class="xref py py-class docutils literal notranslate"><span class="pre">yamlprocessor.dataprocess.DataProcessor</span></code></a> instance.</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<p>For example, if we have <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">YP_SCHEMA_PREFIX=file:///etc/</span></code> in the
environment, both of the following examples will result in a validation
against the JSON schema in <code class="docutils literal notranslate"><span class="pre">file:///etc/world/hello.schema.json</span></code>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#!file:///etc/world/hello.schema.json</span><span class="w"></span>
<span class="nt">greet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth</span><span class="w"></span>
<span class="c1"># ...</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#!world/hello.schema.json</span><span class="w"></span>
<span class="nt">greet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">earth</span><span class="w"></span>
<span class="c1"># ...</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="basic-usage.html" class="btn btn-neutral float-left" title="Basic Usages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="schema-process.html" class="btn btn-neutral float-right" title="Schema Processor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Matt Shin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>